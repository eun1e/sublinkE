import{d as e,r as a,o as l,C as t,c as o,e as u,Z as s,w as i,l as n,a2 as r,m,$ as p,g as d,t as c,ay as v,W as f,aH as y,a0 as g,a1 as _,aN as k,aO as C}from"./index.BIi4ItqP.js";import{E as w}from"./el-card.BsgHnynV.js";import{E as h,a as j,b as x}from"./el-table-column.DSRLcwN5.js";import{E as b}from"./el-tag.BlCuka-F.js";import"./el-select.DYCQhOXW.js";import"./el-scrollbar.BCBj2iz1.js";import"./el-popper.Bw01UaGB.js";import"./el-tooltip.l0sNRNKZ.js";import{E as V}from"./el-dialog.DdlDQyiG.js";import{g as z,A as D,U as E,D as I,E as U,a as N}from"./node.D9OnoKmp.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./isEqual.D1ZakqDZ.js";import"./_initCloneObject.Cr1PHk_Z.js";import"./debounce.3T7hALvl.js";import"./index.Clffk_n0.js";import"./strings.BgEpsYir.js";import"./isUndefined.DgmxjSXK.js";import"./use-dialog.CS3UFbH-.js";import"./refs.Dr4-jDrv.js";const B=e=>(k("data-v-3ca60c61"),e=e(),C(),e),O={class:"dialog-footer"},R=B((()=>n("div",{style:{"margin-bottom":"10px"}},null,-1))),S=B((()=>n("div",{style:{"margin-top":"20px"}},null,-1))),L=B((()=>n("div",{style:{"margin-top":"20px"}},null,-1))),A=T(e({__name:"nodes",setup(e){const k=a([]),C=a(""),T=a(""),B=a(""),A=a(""),H=a(!1),K=a(),$=a(""),q=a("1");async function F(){const{data:e}=await z();k.value=e}l((async()=>{F()}));const G=()=>{$.value="添加节点",C.value="",B.value="",q.value="1",H.value=!0},J=async()=>{let e=C.value.split(/[\r\n,]/);if(e=e.map((e=>e.trim())).filter((e=>""!==e)),"添加节点"==$.value){if("1"===q.value){if(""===B.value.trim())return void v.error("备注不能为空");e&&(C.value=e.join(","),await D({link:C.value.trim(),name:B.value.trim()}))}else for(let a=0;a<e.length;a++)await D({link:e[a],name:""});v.success("添加成功")}else await E({oldname:A.value.trim(),oldlink:T.value.trim(),link:C.value.trim(),name:B.value.trim()}),v.success("更新成功");F(),C.value="",B.value="",H.value=!1},M=a([]),P=e=>{M.value=e},W=()=>{0!==M.value.length&&y.confirm("你是否要删除选中这些 ?","提示",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((()=>{for(let e=0;e<M.value.length;e++)I({id:M.value[e].ID}),k.value=k.value.filter((a=>a.ID!==M.value[e].ID));v({type:"success",message:"删除成功"})}))},Z=a(1),Q=a(10),X=e=>{Q.value=e},Y=e=>{Z.value=e},ee=t((()=>{const e=(Z.value-1)*Q.value,a=e+Q.value;return k.value.slice(e,a)})),ae=e=>{(e=>{const a=document.createElement("textarea");a.value=e,document.body.appendChild(a),a.select();try{const e=document.execCommand("copy");v({type:e?"success":"warning",message:e?"复制成功！":"复制失败！"})}catch(l){v({type:"warning",message:"复制失败！"})}finally{document.body.removeChild(a)}})(e.Link)};return(e,a)=>{const l=g,t=U,z=N,D=_,E=V,M=h,le=b,te=j,oe=x,ue=w;return o(),u("div",null,[s(E,{modelValue:H.value,"onUpdate:modelValue":a[4]||(a[4]=e=>H.value=e),title:$.value,width:"80%"},{footer:i((()=>[n("div",O,[s(D,{onClick:a[3]||(a[3]=e=>H.value=!1)},{default:i((()=>[r("关闭")])),_:1}),s(D,{type:"primary",onClick:J},{default:i((()=>[r("确定")])),_:1})])])),default:i((()=>[s(l,{modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value=e),placeholder:"请输入节点多行使用回车或逗号分开,支持base64格式的url订阅",type:"textarea",style:{"margin-bottom":"10px"},autosize:{minRows:2,maxRows:10}},null,8,["modelValue"]),"添加节点"==$.value?(o(),m(z,{key:0,modelValue:q.value,"onUpdate:modelValue":a[1]||(a[1]=e=>q.value=e),class:"ml-4"},{default:i((()=>[s(t,{value:"1",size:"large"},{default:i((()=>[r("合并")])),_:1}),s(t,{value:"2",size:"large"},{default:i((()=>[r("分开")])),_:1})])),_:1},8,["modelValue"])):p("",!0),"2"!=q.value?(o(),m(l,{key:1,modelValue:B.value,"onUpdate:modelValue":a[2]||(a[2]=e=>B.value=e),placeholder:"请输入备注"},null,8,["modelValue"])):p("",!0)])),_:1},8,["modelValue","title"]),s(ue,null,{default:i((()=>[s(D,{type:"primary",onClick:G},{default:i((()=>[r("添加节点")])),_:1}),R,s(te,{ref_key:"table",ref:K,data:d(ee),style:{width:"100%"},onSelectionChange:P},{default:i((()=>[s(M,{type:"selection",fixed:"",prop:"ID",label:"id"}),s(M,{prop:"Name",label:"备注"},{default:i((e=>[s(le,{type:"success"},{default:i((()=>[r(c(e.row.Name),1)])),_:2},1024)])),_:1}),s(M,{prop:"Link",label:"节点",sortable:"","show-overflow-tooltip":!0}),s(M,{prop:"CreateDate",label:"创建时间",sortable:""}),s(M,{fixed:"right",label:"操作",width:"120"},{default:i((e=>[s(D,{link:"",type:"primary",size:"small",onClick:a=>ae(e.row)},{default:i((()=>[r("复制")])),_:2},1032,["onClick"]),s(D,{link:"",type:"primary",size:"small",onClick:a=>(e=>{q.value="1";for(let a=0;a<k.value.length;a++)k.value[a].ID===e.ID&&($.value="编辑节点",B.value=k.value[a].Name,A.value=B.value,C.value=k.value[a].Link,T.value=C.value,H.value=!0)})(e.row)},{default:i((()=>[r("编辑")])),_:2},1032,["onClick"]),s(D,{link:"",type:"primary",size:"small",onClick:a=>{return l=e.row,void y.confirm(`你是否要删除 ${l.Name} ?`,"提示",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((async()=>{await I({id:l.ID}),v({type:"success",message:"删除成功"}),F()}));var l}},{default:i((()=>[r("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),S,s(D,{type:"info",onClick:a[5]||(a[5]=e=>{f((()=>{k.value.forEach((e=>{K.value.toggleRowSelection(e,!0)}))}))})},{default:i((()=>[r("全选")])),_:1}),s(D,{type:"warning",onClick:a[6]||(a[6]=e=>{K.value.clearSelection()})},{default:i((()=>[r("取消选择")])),_:1}),s(D,{type:"danger",onClick:W},{default:i((()=>[r("批量删除")])),_:1}),L,s(oe,{onSizeChange:X,onCurrentChange:Y,"current-page":Z.value,"page-size":Q.value,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,30,40],total:k.value.length},null,8,["current-page","page-size","total"])])),_:1})])}}}),[["__scopeId","data-v-3ca60c61"]]);export{A as default};

import{d as e,r as a,o as l,B as t,c as o,e as u,$ as i,w as r,m as s,Y as n,a4 as m,a6 as d,l as p,a5 as v,g as c,t as f,aA as _,a7 as y,aJ as g}from"./index.De7oQXzt.js";import{E as k}from"./el-card.Ddjk6a0D.js";import{E as x,a as C,b as h}from"./el-table-column.zfX7_4Wx.js";import{E as j}from"./el-tag.CgFp2Jm5.js";import"./el-select.BsjgHyJt.js";import"./el-scrollbar.DlP7n3hc.js";import"./el-popper.CfrP2Wyl.js";import"./el-tooltip.l0sNRNKZ.js";import{E as w}from"./el-dialog.asrE6idC.js";import{E as b,a as V,g as z,A as D,U as E,D as I}from"./node.PwVXtd7Y.js";import{_ as N}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./isEqual.B3IXmudt.js";import"./_initCloneObject.CWoh3IgJ.js";import"./debounce.D0GXsc8l.js";import"./index.CvXAAfJR.js";import"./strings.Cs5Roz1q.js";import"./castArray.Djg6z-ho.js";import"./index.CB4Cp5_6.js";import"./isUndefined.DgmxjSXK.js";import"./use-dialog.qv8jPdtl.js";import"./refs.CTtEOxkY.js";const U={class:"dialog-footer"},B=N(e({__name:"nodes",setup(e){const N=a([]),B=a(""),S=a(""),A=a(""),O=a(""),P=a(""),T=a(!1),K=a(),L=a(""),R=a("1");async function H(){const{data:e}=await z();N.value=e}l((async()=>{H()}));const J=()=>{L.value="添加节点",B.value="",A.value="",R.value="1",P.value="",T.value=!0},$=async()=>{let e=B.value.split(/[\r\n,]/);if(e=e.map((e=>e.trim())).filter((e=>""!==e)),"添加节点"==L.value){if("1"===R.value){if(""===A.value.trim())return void _.error("备注不能为空");e&&(B.value=e.join(","),await D({link:B.value.trim(),name:A.value.trim(),dialerProxyName:P.value.trim()}))}else for(let a=0;a<e.length;a++)await D({link:e[a],name:"",dialerProxyName:P.value.trim()});_.success("添加成功")}else await E({oldname:O.value.trim(),oldlink:S.value.trim(),link:B.value.trim(),name:A.value.trim(),dialerProxyName:P.value.trim()}),_.success("更新成功");H(),B.value="",A.value="",T.value=!1},q=a([]),F=e=>{q.value=e},G=()=>{0!==q.value.length&&g.confirm("你是否要删除选中这些 ?","提示",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((()=>{for(let e=0;e<q.value.length;e++)I({id:q.value[e].ID}),N.value=N.value.filter((a=>a.ID!==q.value[e].ID));_({type:"success",message:"删除成功"})}))},M=a(1),Q=a(10),Y=e=>{Q.value=e},W=e=>{M.value=e},X=t((()=>{const e=(M.value-1)*Q.value,a=e+Q.value;return N.value.slice(e,a)})),Z=e=>{(e=>{const a=document.createElement("textarea");a.value=e,document.body.appendChild(a),a.select();try{const e=document.execCommand("copy");_({type:e?"success":"warning",message:e?"复制成功！":"复制失败！"})}catch(l){_({type:"warning",message:"复制失败！"})}finally{document.body.removeChild(a)}})(e.Link)};return(e,a)=>{const l=m,t=V,z=b,D=v,E=w,q=C,ee=j,ae=x,le=h,te=k;return u(),o("div",null,[i(E,{modelValue:T.value,"onUpdate:modelValue":a[5]||(a[5]=e=>T.value=e),title:L.value,width:"80%"},{footer:r((()=>[p("div",U,[i(D,{onClick:a[4]||(a[4]=e=>T.value=!1)},{default:r((()=>a[10]||(a[10]=[d("关闭")]))),_:1,__:[10]}),i(D,{type:"primary",onClick:$},{default:r((()=>a[11]||(a[11]=[d("确定")]))),_:1,__:[11]})])])),default:r((()=>[i(l,{modelValue:B.value,"onUpdate:modelValue":a[0]||(a[0]=e=>B.value=e),placeholder:"请输入节点多行使用回车或逗号分开,支持base64格式的url订阅",type:"textarea",style:{"margin-bottom":"10px"},autosize:{minRows:2,maxRows:10}},null,8,["modelValue"]),"添加节点"==L.value?(u(),s(z,{key:0,modelValue:R.value,"onUpdate:modelValue":a[1]||(a[1]=e=>R.value=e),class:"ml-4"},{default:r((()=>[i(t,{value:"1",size:"large"},{default:r((()=>a[8]||(a[8]=[d("合并")]))),_:1,__:[8]}),i(t,{value:"2",size:"large"},{default:r((()=>a[9]||(a[9]=[d("分开")]))),_:1,__:[9]})])),_:1},8,["modelValue"])):n("",!0),"2"!=R.value?(u(),s(l,{key:1,modelValue:A.value,"onUpdate:modelValue":a[2]||(a[2]=e=>A.value=e),placeholder:"请输入备注"},null,8,["modelValue"])):n("",!0),i(l,{modelValue:P.value,"onUpdate:modelValue":a[3]||(a[3]=e=>P.value=e),placeholder:"请输入前置代理节点名称(仅Clash-Meta内核可用)"},null,8,["modelValue"])])),_:1},8,["modelValue","title"]),i(te,null,{default:r((()=>[i(D,{type:"primary",onClick:J},{default:r((()=>a[12]||(a[12]=[d("添加节点")]))),_:1,__:[12]}),a[19]||(a[19]=p("div",{style:{"margin-bottom":"10px"}},null,-1)),i(ae,{ref_key:"table",ref:K,data:c(X),style:{width:"100%"},onSelectionChange:F},{default:r((()=>[i(q,{type:"selection",fixed:"",prop:"ID",label:"id"}),i(q,{prop:"Name",label:"备注"},{default:r((e=>[i(ee,{type:"success"},{default:r((()=>[d(f(e.row.Name),1)])),_:2},1024)])),_:1}),i(q,{prop:"Link",label:"节点",sortable:"","show-overflow-tooltip":!0}),i(q,{prop:"CreateDate",label:"创建时间",sortable:""}),i(q,{fixed:"right",label:"操作",width:"120"},{default:r((e=>[i(D,{link:"",type:"primary",size:"small",onClick:a=>Z(e.row)},{default:r((()=>a[13]||(a[13]=[d("复制")]))),_:2,__:[13]},1032,["onClick"]),i(D,{link:"",type:"primary",size:"small",onClick:a=>(e=>{R.value="1";for(let a=0;a<N.value.length;a++)N.value[a].ID===e.ID&&(L.value="编辑节点",A.value=N.value[a].Name,O.value=A.value,B.value=N.value[a].Link,S.value=B.value,P.value=N.value[a].DialerProxyName,T.value=!0)})(e.row)},{default:r((()=>a[14]||(a[14]=[d("编辑")]))),_:2,__:[14]},1032,["onClick"]),i(D,{link:"",type:"primary",size:"small",onClick:a=>{return l=e.row,void g.confirm(`你是否要删除 ${l.Name} ?`,"提示",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((async()=>{await I({id:l.ID}),_({type:"success",message:"删除成功"}),H()}));var l}},{default:r((()=>a[15]||(a[15]=[d("删除")]))),_:2,__:[15]},1032,["onClick"])])),_:1})])),_:1},8,["data"]),a[20]||(a[20]=p("div",{style:{"margin-top":"20px"}},null,-1)),i(D,{type:"info",onClick:a[6]||(a[6]=e=>{y((()=>{N.value.forEach((e=>{K.value.toggleRowSelection(e,!0)}))}))})},{default:r((()=>a[16]||(a[16]=[d("全选")]))),_:1,__:[16]}),i(D,{type:"warning",onClick:a[7]||(a[7]=e=>{K.value.clearSelection()})},{default:r((()=>a[17]||(a[17]=[d("取消选择")]))),_:1,__:[17]}),i(D,{type:"danger",onClick:G},{default:r((()=>a[18]||(a[18]=[d("批量删除")]))),_:1,__:[18]}),a[21]||(a[21]=p("div",{style:{"margin-top":"20px"}},null,-1)),i(le,{onSizeChange:Y,onCurrentChange:W,"current-page":M.value,"page-size":Q.value,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,30,40],total:N.value.length},null,8,["current-page","page-size","total"])])),_:1,__:[19,20,21]})])}}}),[["__scopeId","data-v-280ce72a"]]);export{B as default};
